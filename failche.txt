<?php include('partials-front/menu.php'); ?>

    <!-- fOOD sEARCH Section Starts Here -->
    <section class="food-search text-center">
        <div class="container">
            
            <form action="<?php echo SITEURL; ?>food-search.php" method="POST">
                <input type="search" name="search" placeholder="Search for Food.." required>
                <input type="submit" name="submit" value="Search" class="btn btn-primary">
            </form>

        </div>
    </section>
    <!-- fOOD sEARCH Section Ends Here -->



    <!-- fOOD MEnu Section Starts Here -->
    <section class="food-menu">
        <div class="container">
            <h2 class="text-center">All foods from the menu</h2>

            <?php 
                //Display Foods that are Active
                $sql = "SELECT * FROM tbl_food WHERE active='Yes'";

                //Execute the Query
                $res=mysqli_query($conn, $sql);

                //Count Rows
                $count = mysqli_num_rows($res);

                //CHeck whether the foods are available or not
                if($count>0)
                {
                    //Foods Available
                    while($row=mysqli_fetch_assoc($res))
                    {
                        //Get the Values
                        $id = $row['id'];
                        $title = $row['title'];
                        $description = $row['description'];
                        $price = $row['price'];
                        $image_name = $row['image_name'];
                        ?>
                        
                        <div class="food-menu-box">
                            <div class="food-menu-img">
                                <?php 
                                    //CHeck whether image available or not
                                    if($image_name=="")
                                    {
                                        //Image not Available
                                        echo "<div class='error'>Image not Available.</div>";
                                    }
                                    else
                                    {
                                        //Image Available
                                        ?>
                                        <img src="<?php echo SITEURL; ?>images/food/<?php echo $image_name; ?>" alt="Image" class="img-responsive-food img-curve">
                                        <?php
                                    }
                                ?>
                                
                            </div>
                                
                            <div class="food-menu-desc">
                                <h4><?php echo $title; ?></h4>
                                <p class="food-price">$<?php echo $price; ?></p>
                                <p class="food-detail">
                                    <?php echo $description; ?>
                                </p>
                                <br>
                                    
                                <a href="<?php echo SITEURL; ?>order.php?food_id=<?php echo $id; ?>" class="btn btn-primary">Add to cart</a>
                                
                            </div>
                        </div>

                        <?php
                    }
                }
                else
                {
                    //Food not Available
                    echo "<div class='error'>Food not found.</div>";
                }
            ?>

            <div class="clearfix"></div>

            

        </div>

    </section>
    <!-- fOOD Menu Section Ends Here -->

    <?php include('partials-front/footer.php'); ?>



    <!-- -->
    <?php include('partials-front/menu.php'); ?>

<?php
if(isset($_POST["add_to_cart"]))
{
	if(isset($_SESSION["shopping_cart"]))
	{
		$item_array_id = array_column($_SESSION["shopping_cart"], "id");
		if(!in_array($_GET["id"], $item_array_id))
		{
			$count = count($_SESSION["shopping_cart"]);
			$item_array = array(
				'id'			=>	$_GET["id"],
				'title'			=>	$_POST["hidden_title"],
				'price'		=>	$_POST["hidden_price"],
				'quantity'		=>	$_POST["quantity"]
			);
			$_SESSION["shopping_cart"][$count] = $item_array;
		}
		else
		{
			echo '<script>alert("Item Already Added")</script>';
		}
	}
	else
	{
		$item_array = array(
			'id'			=>	$_GET["id"],
			'title'			=>	$_POST["hidden_title"],
			'price'		=>	$_POST["hidden_price"],
			'quantity'		=>	$_POST["quantity"]
		);
		$_SESSION["shopping_cart"][0] = $item_array;
	}
}

if(isset($_GET["action"]))
{
	if($_GET["action"] == "delete")
	{
		foreach($_SESSION["shopping_cart"] as $keys => $values)
		{
			if($values["id"] == $_GET["id"])
			{
				unset($_SESSION["shopping_cart"][$keys]);
				echo '<script>alert("Item Removed")</script>';
				echo '<script>window.location="shopping-cart.php"</script>';
			}
		}
	}
}

?>

<?php
	$sql = "SELECT * FROM tbl_food ORDER BY id ASC";
	$res = mysqli_query($conn, $sql);
		if(mysqli_num_rows($res) > 0)
			{
				while($row = mysqli_fetch_array($res))
			{
?>

<div class="shopping-cart">
				<form method="post" action="shopping-cart.php?action=add&id=<?php echo $row["id"]; ?>">
               <img src="<?php echo SITEURL; ?>images/food/<?php echo $image_name; ?>" alt="Image" class="img-responsive-food img-curve">
						<h4 class="text-info"><?php echo $row["title"]; ?></h4>

						<h4 class="text-danger">$ <?php echo $row["price"]; ?></h4>

						<input type="text" name="quantity" value="1" class="form-control" />

						<input type="hidden" name="hidden_title" value="<?php echo $row["title"]; ?>" />

						<input type="hidden" name="hidden_price" value="<?php echo $row["price"]; ?>" />

						<input type="submit" name="add_to_cart" style="margin-top:5px;" class="btn btn-success" value="Add to Cart" />

					
				</form>
</div>
			<?php
					}
				}
			?>
			<div style="clear:both"></div>
			<br/>
         
         <h1 class="text-center">Shopping cart</h1>
				<table class="container_l">
					<tr>
                  <th>title</th>
                  <th>price</th>
                  <th>quantity</th>
                  <th>total price</th>
                  <th>action</th>
					</tr>
					<?php
					if(!empty($_SESSION["shopping_cart"]))
					{
						$total = 0;
						foreach($_SESSION["shopping_cart"] as $keys => $values)
						{
					?>
					<tr>
						<td><?php echo $values["title"]; ?></td>
						<td><?php echo $values["quantity"]; ?></td>
						<td>$ <?php echo $values["price"]; ?></td>
						<td>$ <?php echo number_format($values["quantity"] * $values["price"], 2);?></td>
						<td><a href="shopping-cart.php?action=delete&id=<?php echo $values["id"]; ?>"><span class="text-danger">Remove</span></a></td>
					</tr>
					<?php
							$total = $total + ($values["quantity"] * $values["price"]);
						}
					?>
					<tr>
						<td colspan="3" align="right">Total</td>
						<td align="right">$ <?php echo number_format($total, 2); ?></td>
						<td></td>
					</tr>
					<?php
					}
					?>
						
				</table>
		</div>
   </div>
   
<!-- 
<div class="shopping-cart">

   <h1 class="text-center">Shopping cart</h1>

   <br><br>

   <table class="container_l">
      <thead>
         <th>image</th>
         <th>name</th>
         <th>price</th>
         <th>quantity</th>
         <th>total price</th>
         <th>action</th>
      </thead>
      
   </tbody>
   </table>

   <br><br>

   <div class="cart-btn text-center">  
      <a href="#" class="btn <?php echo ($grand_total > 1)?'':'disabled'; ?>">proceed to checkout</a>
   </div>

</div>
-->



<?php include('partials-front/footer.php'); ?>


<!-- -->
teodora.strahilova@abv.bg - 123456

<!-- foods.php -->
<?php include('partials-front/menu.php'); ?>

    <!-- fOOD sEARCH Section Starts Here -->
    <section class="food-search text-center">
        <div class="container">
            
            <form action="<?php echo SITEURL; ?>food-search.php" method="POST">
                <input type="search" name="search" placeholder="Search for Food.." required>
                <input type="submit" name="submit" value="Search" class="btn btn-primary">
            </form>

        </div>
    </section>
    <!-- fOOD sEARCH Section Ends Here -->

    <!-- Add to cart -->
    <?php
    if(isset($_POST['add_to_cart'])){

    $name = $_POST['name'];
    $price = $_POST['price'];
    $image_name = $_POST['image_name'];
    $qty = 1;

    $select_cart = mysqli_query($conn, "SELECT * FROM `cart` WHERE name = '$name'");

    if(mysqli_num_rows($select_cart) > 0){
    $message[] = 'food already added to cart';
    }else{
    $insert_food = mysqli_query($conn, "INSERT INTO `tbl_cart`(name, price, image_name, qty) VALUES('$name', '$price', '$image_name', '$qty')");
    $message[] = 'food added to cart succesfully';
    }

    }
    ?>

    <!-- fOOD MEnu Section Starts Here -->
    <section class="food-menu">
        <div class="container">
            <h2 class="text-center">All foods from the menu</h2>

            <?php 
                //Display Foods that are Active
                $sql = "SELECT * FROM tbl_food WHERE active='Yes'";

                //Execute the Query
                $res=mysqli_query($conn, $sql);

                //Count Rows
                $count = mysqli_num_rows($res);

                //CHeck whether the foods are available or not
                if($count>0)
                {
                    //Foods Available
                    while($row=mysqli_fetch_assoc($res))
                    {
                        //Get the Values
                        $id = $row['id'];
                        $title = $row['title'];
                        $description = $row['description'];
                        $price = $row['price'];
                        $image_name = $row['image_name'];
                        ?>
                        
                        <div class="food-menu-box">
                            <div class="food-menu-img">
                                <?php 
                                    //CHeck whether image available or not
                                    if($image_name=="")
                                    {
                                        //Image not Available
                                        echo "<div class='error'>Image not Available.</div>";
                                    }
                                    else
                                    {
                                        //Image Available
                                        ?>
                                        <img src="<?php echo SITEURL; ?>images/food/<?php echo $image_name; ?>" alt="Image" class="img-responsive-food img-curve">
                                        <?php
                                    }
                                ?>
                                
                            </div>
                                
                            <div class="food-menu-desc">
                                <h4><?php echo $title; ?></h4>
                                <p class="food-price">$<?php echo $price; ?></p>
                                <p class="food-detail">
                                    <?php echo $description; ?>
                                </p>
                                <br>
                                  
                                <?php
                                if(isset($_SESSION['email'])){ //когато е влязъл в профила си 
                                ?>
                                <!-- трябва да добавя в количката-->

                                <?php
                                    $select_foods = mysqli_query($conn, "SELECT * FROM `tbl_food`");
                                    if(mysqli_num_rows($select_foods) > 0){
                                        while($fetch_food = mysqli_fetch_assoc($select_foods)){
                                ?>

                                <!-- <a href="<?php echo SITEURL; ?>order.php?food_id=<?php echo $id; ?>" class="btn btn-primary">Add to cart</a> -->
                                
                                <!-- -->
                                    <form action="" method="post">
                                        
                                            <img src="uploaded_img/<?php echo $fetch_food['image_name']; ?>" alt="">
                                            <!-- <h3><?php echo $fetch_food['name']; ?></h3> -->
                                            <!-- <div class="price">$<?php echo $fetch_food['price']; ?>/-</div> -->
                                            <input type="hidden" name="name" value="<?php echo $fetch_food['name']; ?>">
                                            <input type="hidden" name="price" value="<?php echo $fetch_food['price']; ?>">
                                            <input type="hidden" name="image_name" value="<?php echo $fetch_food['image_name']; ?>">
                                            <input type="submit" class="btn btn-primary" value="Add to cart" name="add_to_cart">
                                        
                                    </form>
                                

                                <?php
                                    }
                                }
                                ?>

                                <?php
                                }else{  //когато не е влязъл в профила си потребителят
                                ?>
                                
                                <a href="<?php echo SITEURL; ?>login.php?food_id=<?php echo $id; ?>" class="btn btn-primary">Add to cart</a>

                                <?php
                                    }
                                ?>

                            </div>
                        </div>

                        <?php
                    }
                }
                else
                {
                    //Food not Available
                    echo "<div class='error'>Food not found.</div>";
                }
            ?>

            <div class="clearfix"></div>

            

        </div>

    </section>
    <!-- fOOD Menu Section Ends Here -->

    <?php include('partials-front/footer.php'); ?>


<!-- style.css -->

/* CSS for All */
*{
    /* margin: 0 0; */
    padding: 0 0;
    box-sizing: border-box;
    font-family: Arial, Helvetica, sans-serif;
}
.container{
    width: 80%;
    margin: 0 auto;
    padding: 1%;
}

.img-logo{
    width: 170%;
}

.img-responsive{
    width: 320px;
    height: 430px;
}

.img-responsive-food{
    width: 100%;
}

.img-curve{
    border-radius: 15px;
}

/* css for img*/
.image {
    position: relative;
    width: 400px;
}


.image__overlay{
    position: absolute;
    top: 0;
    left: 0;
    width: 320px;
    height: 430px;
    color: #ffffff;
    font-family: 'Quicksand', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
}

.image__overlay--blur {
    backdrop-filter: blur(5px);
}

.image__overlay--primary {
    background: rgba(255,71,87, 0.3);
    
    border-radius: 15px;
}

.image__overlay > * {
    transform: translateY(20px);
    transition: transform 0.25s;
}

.image__overlay:hover {
    opacity: 1;
}

.image__overlay:hover > * {
    transform: translateY(0);
}

.image__title {
    font-size: 2em;
    font-weight: bold;
}

.image__description {
    font-size: 1.25em;
    margin-top: 0.25em;
}

/* */


.text-right{
    text-align: right;
}
.text-center{
    text-align: center;
}
.text-left{
    text-align: left;
}
.text-white{
    color: white;
}

.clearfix{
    clear: both;
    float: none;
}

a{
    color: #ff6b81;
    text-decoration: none;
}
a:hover{
    color: #ff4757;
}

.btn{
    padding: 1%;
    border: none;
    font-size: 1rem;
    border-radius: 5px;
}

.btn-primary{
    background-color: #ff6b81;
    /* color: white; */
    cursor: pointer;
}
.btn-primary:hover{
    color: white;
    background-color: #ff4757;
}

h2{
    color: #2f3542;
    font-size: 2rem;
    margin-bottom: 2%;
}
h3{
    font-size: 1.5rem;
}
.float-container{
    position: relative;
}
.float-text{
    position: absolute;
    bottom: 50px;
    left: 40%;
}
fieldset{
    border: 1px solid white;
    margin: 5%;
    padding: 3%;
    border-radius: 5px;
}

.error{
    padding: 2%;
    color: red;
}
.success{
    padding: 2%;
    color: green;
}

/* CSS for navbar section */

.logo{
    width: 10%;
    float: left;
}
.menu{
    font-size: 18px;
    line-height: 60px;
}
.menu ul{
    list-style-type: none;
}

.menu ul li{
    display: inline;
    padding: 1%;
    font-weight: bold;
}


/* CSS for Food Search Section */

.food-search{
    background-image: url(../images/bg.jpg);
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
    padding: 7% 0;
}

.food-search input[type="search"]{
    width: 50%;
    padding: 1%;
    font-size: 1rem;
    border: none;
    border-radius: 5px;
}


/* CSS for Categories */
.categories{
    padding: 4% 0;
}

.box-3{
    width: 28%;
    float: left;
    margin: 2%;
}


/* CSS for Food Menu */
.food-menu{
    background-color: #ececec;
    padding: 4% 0;
}
.food-menu-box{
    width: 43%;
    margin: 3%;
    padding: 2%;
    float: left;
    background-color: white;
    border-radius: 15px;
}

.food-menu-img{
    width: 22%;
    float: left;
}

.food-menu-desc{
    width: 70%;
    float: left;
    margin-left: 8%;
}

.food-price{
    font-size: 1.2rem;
    margin: 2% 0;
}
.food-detail{
    font-size: 1rem;
    color: #747d8c;
}


/* CSS for Social */
.social ul{
    list-style-type: none;
}
.social ul li{
    display: inline;
    padding: 1%;
}

/* for Order Section */
.order{
    width: 50%;
    margin: 0 auto;
}
.input-responsive{
    width: 96%;
    padding: 1%;
    margin-bottom: 3%;
    border: none;
    border-radius: 5px;
    font-size: 1rem;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
}
.order-label{
    margin-bottom: 1%; 
    font-weight: bold;
}


/* CSS for Mobile Size or Smaller Screen */

@media only screen and (max-width:768px){
    .logo{
        width: 80%;
        float: none;
        margin: 1% auto;
    }

    .menu ul{
        text-align: center;
    }

    .food-search input[type="search"]{
        width: 90%;
        padding: 2%;
        margin-bottom: 3%;
    }

    .btn{
        width: 91%;
        padding: 2%;
    }

    .food-search{
        padding: 10% 0;
    }

    .categories{
        padding: 20% 0;
    }
    h2{
        margin-bottom: 10%;
    }
    .box-3{
        width: 100%;
        margin: 4% auto;
    }

    .food-menu{
        padding: 20% 0;
    }

    .food-menu-box{
        width: 100%;
        padding: 15%;
        margin-bottom: 5%;
    }
    .social{
        padding: 5% 0;
    }
    .order{
        width: 100%;
    }
}


/*login and shopping cart css*/
.container_user{
    padding:0 20px;
    margin:0 auto;
    max-width: 1200px;
    padding-bottom: 70px;
 }
 
 .container_user .heading{
    text-align: center;
    margin-bottom: 20px;
    font-size: 40px;
    text-transform: uppercase;
    color:var(--black);
 }
 
 .container_user .user-profile{
    padding:20px;
    text-align: center;
    border:var(--border);
    background-color: var(--white);
    box-shadow: var(--box-shadow);
    border-radius: 5px;
    margin:20px auto;
    max-width: 500px;
 }
 
 .container_user .user-profile p{
    margin-bottom: 10px;
    font-size: 25px;
    color:var(--black);
 }

.container_user .user-profile p span{
    color:var(--red);
 }
 
 .container_user .user-profile .flex{
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap:10px;
    align-items: flex-end;
 }

 /*CSS for Login*/

.container_l {
    position: relative;
    z-index: 1;
    width: 300px;
    margin: 0 auto;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
    padding: 40px 30px;
  }

.container_l_t {
    width: 1000px;
} 

.container_l .login-email .input-group {
    width: 100%;
    height: 50px;
    margin-bottom: 25px;
}

.container_l .login-email .input-group input {
    
    border: 2px solid #ececec;
    padding: 15px 20px;
    font-size: 1rem;
    border-radius: 5px;
    background: transparent;
    outline: none;
    transition: .3s;
}

.container_l .login-email .input-group input:focus, .container .login-email .input-group input:valid {
    border-color: rgb(219, 219, 219);
}

.container_l .login-email .input-group .btn_l {
    display: block;
    width: 100%;
    padding: 15px 20px;
    text-align: center;
    border: none;
    background-color: #ff6b81;
    border-radius: 5px;
    outline: none;
    font-size: 1rem;
    cursor: pointer;
    transition: .3s;
}


.container_l .login-email .input-group .btn_l:hover {
    transform: translateY(-5px);
    background: #ff6b81;
}

/* cart */

table tr th{
    border-bottom: 1px solid black;
    padding: 1%;
    text-align: left;
}

table tr td{
    background-color: #ffdcdc;
    padding: 1%;
}

/*br tag*/
.br {
    margin-bottom: 25em
}


<!-- checkout.php -->
<?php include('partials-front/menu.php'); ?>

<?php
//error_reporting(0);
if(isset($_POST['order_btn'])){

$id_user = $_SESSION['id'];
$name = $_POST['name'];
$email = $_POST['email'];
$phone = $_POST['phone'];
$address = $_POST['address'];
$order_date = date("Y-m-d h:i:sa");
$shipping = 3;
$status = "Ordered";
$note = $_POST['note'];

$id_food = $_POST['id_food'];
//$total_idp = implode(',',$id_food);
//$string_idf = json_encode($id_food);

$qty = $_POST['qty'];
//$string_qty = serialize($qty);

$cart_query = mysqli_query($conn, "SELECT * FROM `tbl_cart`");
$price_total = 0;
if(mysqli_num_rows($cart_query) > 0){
   while($product_item = mysqli_fetch_assoc($cart_query)){
      
    ?>
    <table>
        <td>
    <?php
        $title[] = $product_item['title'] .' ('. $product_item['qty'] .') ';
        $price = number_format($product_item['price'] * $product_item['qty']);
        $price_total += $price;
    ?>
        </td>
    </table>
    <?php

   };
};

//$total_product = implode(', ',$title);

$detail_query = "INSERT INTO `tbl_order`(id_user, shipping, order_date, status, address, note) VALUES('$id_user','$shipping','$order_date','$status','$address','$note')";
//$sql_query .= "SELECT id FROM `tbl_order` WHERE id_user = '$id_user'";
//$sql_query .= "INSERT INTO `tbl_details`(id_order, id_food, price, qty)  VALUES('$id_order, $id_food, $price, $qty')"; 

//$res = mysqli_multi_query($conn, $sql_query);

//$detail_query = mysqli_query($conn, "INSERT INTO `tbl_order`(id_user, shipping, order_date, status, address, note) VALUES('$id_user','$shipping','$order_date','$status','$address','$note')") or die('query failed');

//$id_order = mysqli_query($conn, "SELECT id FROM `tbl_order` WHERE id_user = '$id_user'") or die ('query failed');
//$order_query

//$details_query = mysqli_query($conn, "INSERT INTO `tbl_details`(id_order, id_food, price, qty)  VALUES('$id_order, $id_food, $price, $qty')") or die('query failed');

//$details_query = mysqli_query($conn, "INSERT INTO `tbl_details`(id_order, id_food, price, qty)  VALUES('$id_order, $id_user, $price_total, $qty')") or die('query failed');

if($cart_query && $detail_query){ //трябва да направя страници за готова поръчка или ако има някаква грешка???
    
    mysqli_query($conn, "DELETE FROM `tbl_cart` WHERE id_user = '$id_user'");
    echo "
         <p>(*pay when product arrives*)</p>
   ";
   
    $id_user = mysqli_query($conn, "SELECT id FROM `tbl_order` WHERE id_user = '$id_user'");
    if(mysqli_num_rows($id_user) > 0){
        while($fetch_cart = mysqli_fetch_assoc($id_user)){
        mysqli_query($conn, "INSERT INTO `tbl_details`(id_order, id_food, price, qty)  VALUES('$id_order, $id_food, $price, $qty')");
        }   
}    



}

}

?>

<h2 class="text-center">Complete your order</h2>

<section class="categories text-center">
    <div class="container">
        <div class="container_l">

            <form action="" method="post" class="login-email text-center">
                        
            <?php
            $id_user = $_SESSION['id'];
                $select_cart = mysqli_query($conn, "SELECT * FROM `tbl_cart` WHERE id_user = '$id_user' ");
                $total = 0;
                $grand_total = 0;
                if(mysqli_num_rows($select_cart) > 0){
                    while($fetch_cart = mysqli_fetch_assoc($select_cart)){
                    $total_price = number_format($fetch_cart['price'] * $fetch_cart['qty']);
                    $grand_total = $total += $total_price;
            ?>
                        
            <?php
                }
            }else{
                echo "<div><span>Your cart is empty!</span></div>";
            }
            
            $select_data = mysqli_query($conn, "SELECT name, email, phone, address FROM `tbl_users` WHERE id = '".$_SESSION['id']."' ");    
            if(mysqli_num_rows($select_data) > 0){
                            while($fetch_cart = mysqli_fetch_assoc($select_data)){
            ?>                
                            <div class="input-group">
                            <input type="text" placeholder="Name" name="name" value="<?php echo $fetch_cart['name'];?>" readonly>
                            </div>
                                                
                            <div class="input-group">
                            <input type="email" placeholder="Email" name="email" value="<?php echo $fetch_cart['email'];?>" readonly>
                            </div >
                                                    
                            <div class="input-group">
                            <input type="phone" placeholder="Phone number" name="phone" value="<?php echo $fetch_cart['phone'];?>" readonly>
                            </div>
                                                
                            <div class="input-group">
                            <input type="text" placeholder="Address" name="address"  value="<?php echo $fetch_cart['address'];?>" required>
                            </div>

                            <div class="input-group">
                                <textarea name="note" rows="5" cols="31" placeholder="Notes to order."></textarea>
                            </div>
                                
                            <br>
                            <div class="input-group">
                                <input type="submit" value="Order now" name="order_btn" class="btn_l btn-primary">
                            </div>
                        
            </form>
            <?php
                            }
                        }
            ?>
        </div>
    </div>
</section>

<?php include('partials-front/footer.php'); ?>


<!-- shopping_cart with discount -->
